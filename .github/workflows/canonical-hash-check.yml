name: canonical-hash-check

on:
  push:
    tags:
      - 'v*'

jobs:
  generate-hashes:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Generate SHA-256 hashes
        run: |
          echo "Canonical Document Checksums" > checksums.txt
          echo "Generated: $(date -u +"%Y-%m-%d %H:%M:%S UTC")" >> checksums.txt
          echo "Tag: ${{ github.ref_name }}" >> checksums.txt
          echo "" >> checksums.txt
          
          find canonical -type f \( -name "*_v*_*.md" -o -name "*_v*.*.md" \) -exec sha256sum {} \; >> checksums.txt
          find canonical -type f \( -name "*_v*_*.pdf" -o -name "*_v*.*.pdf" \) -exec sha256sum {} \; >> checksums.txt
          
      - name: Display checksums
        run: cat checksums.txt
        
      - name: Upload checksums artifact
        uses: actions/upload-artifact@v4
        with:
          name: canonical-checksums-${{ github.ref_name }}
          path: checksums.txt
          retention-days: 90
